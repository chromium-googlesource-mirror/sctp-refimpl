- Add a missing lock. When a peer sends an INIT, and while we
  are processing it to send a INIT-ACK the socket is closed,
  we did not hold a lock to keep the socket from going away.
  Add protection for this case.
- Change rwlock macros for FreeBSD 6.x.  
  rwlock cannot be used in FreeBSD 6.x.
